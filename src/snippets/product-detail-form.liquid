{%- comment %}

  Product Detail Form Snippet
  ------------------------------------------------------------------------------

  Usage:

  {% include 'product-detail-form',
              product: { product } - required
              current_variant: { variant} - optional
              block: { block } - optional
              submit_button_contents: { string } - required
  %}

{% endcomment -%}

{% if current_variant == blank %}
  {% assign current_variant = product.selected_or_first_available_variant %}
{% endif %}

<div class="product-detail-form" data-product-detail-form>
  <div style="margin-top: auto;">
    <div class="product-titles">
      <h1 {% if block.settings.hide_product_title %}class="d-block d-md-none"{% endif %}>
        {{ product.title }}
      </h1>

      {% if block.settings.subtitle != blank %}
        <div class="p2 {% if template.suffix == 'extended' %}d-none d-md-block{% endif %}">
          {{ block.settings.subtitle }}
        </div>
      {% endif %}
    </div>

    <div class="rte product-detail-form-width">
      {{ product.description }}
    </div>

    <div style="margin: auto 0;">
      {% unless product.has_only_default_variant %}
        {% for option in product.options_with_values %}         
          <div class="selector-wrapper form-group js">
            <label for="SingleOptionSelector-{{ forloop.index0 }}">
              {{ option.name }}
            </label>

            <select
              id="SingleOptionSelector-{{ forloop.index0 }}"
              class="form-control"
              data-single-option-selector
              data-index="option{{ option.position }}">
              {% for value in option.values %}
                <option
                  value="{{ value | escape }}"
                  {% if option.selected_value == value %}selected="selected"{% endif %}>
                    {{ value }}
                </option>
              {% endfor %}
            </select>
          </div>
        {% endfor %}
      {% endunless %}

      <div class="form-group dot-group" style="display: none !important">
        {% comment %} @TODO - need to check if product is a subscription or not, add "Select" if we have space {% endcomment %}
        <label>Qty:</label>
        <div class="dots">
          <div class="dot is-active" data-dot-qty="1">1</div>
          <div class="dot" data-dot-qty="2">2</div>
          <div class="dot" data-dot-qty="4">4</div>
        </div>
      </div>    

      <div class="product-detail-form-width{% if template.suffix == 'extended' %} d-none d-md-block{% endif %}" style="margin: 69px 0 98px;">
        <button
          type="submit"
          name="add"
          class="btn btn-primary btn-block"
          data-add-to-cart
          {% unless current_variant.available %}disabled="disabled"{% endunless %}>
          {{ submit_button_contents }}
        </button>
      </div>
    </div>    
  </div>

  {% if block %}
    {% capture expandable_details_html %}
      {% for i in (1..3) %}
        {% assign detail_title_handle = 'detail_title_' | append: i %}
        {% assign detail_content_handle = 'detail_content_' | append: i %}
        {% assign detail_title = block.settings[detail_title_handle] %}
        {% assign detail_content = block.settings[detail_content_handle] %}
        {% assign expandable_id = 'expand-' | append: block.id | append: '-' | append: i %}

        {% if detail_title != blank or detail_content != blank %}
          <div class="expandable-list">
            <a href="#"
               class="expandable-list__header"
               data-toggle="collapse"
               data-target="#{{ expandable_id }}"
               aria-expanded="false"
               aria-controls="{{ expandable_id }}"
            >
              <span class="d-inline-block" style="margin-right: 15px">
                {{ i | prepend: '0' | append: '.' }}
              </span>
              {{ detail_title }}
            </a>
            <div id="{{ expandable_id }}" class="collapse">
              <div class="expandable-list__body">
                {{ detail_content }}
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    {% endcapture %}

    {{ expandable_details_html }}
  {% endif %}
</div>
